!function(t){t.fn.jQPrefetch=function(n){n=jQuery.extend({ajaxAnchor:"a",ajaxURL:"href",ajaxContainer:".container",currentContainer:document.location.href,exclude:".donotpreload",pageExtension:".html"},n);var e,o=["Link","loading","preLoaded"],a=new Array([]);t(window).on("load",function(){var o=document.location.href.split("/");o=o[o.length-1].split(".")[0],""===o&&(o="index"),t(n.ajaxContainer).addClass(o.toLowerCase()),e=t("."+o.toLowerCase()).parent();var i=a.length;a[i],a.GetMultiArray(i),a[i]["Link.Name"]=o.toLowerCase(),a[i]["Pre.Load.State"]="preLoaded",_scanHtmlLoop(),window.setTimeout(function(){_warmUpCacheLoop()},0)}),_scanHtmlLoop=function(){t(n.ajaxAnchor).not(n.exclude).each(function(){if(null!==t(this).attr(n.ajaxURL)){var e=t(this).attr(n.ajaxURL).split("/");if(e=e[e.length-1].split(".")[0],!a.contains(e)){var o=a.length;a.GetMultiArray(o),a[o]["Link.Name"]=e.toLowerCase(),a[o]["Pre.Load.State"]="Link"}}})},_warmUpCacheLoop=function(){var t=0,n="true";do{if(t>=a.length){n="false";break}if("Link"==a[t]["Pre.Load.State"]){a[t]["Pre.Load.State"]="loading";break}t++}while(a.length>=t);"true"==n&&_prelaodContent(a[t]["Link.Name"])},_prelaodContent=function(o,i){var r=0;t("<div>").load(o+".html "+n.ajaxContainer,function(){var s=document.location.href.split("/");s=s[s.length-1].split(".")[0],""===s&&(s="index"),t(this).find("img").each(function(){r++}),t(this).find("img").on("load",function(){r--,0===r&&(i&&_showContent(o),window.setTimeout(function(){_warmUpCacheLoop()},0))}),t(this).find("img").error(function(){r--}),0===r&&window.setTimeout(function(){_warmUpCacheLoop()},0),t(this).find(n.ajaxContainer).addClass(o.toLowerCase()),e.append(t(this).html()),t("."+o.toLowerCase()).css("display","none"),a[a.indexOf(o)].PreLoadState="preLoaded",_addClick(this,o)})},_addClick=function(e,o){t("."+o.toLowerCase()+" "+n.ajaxAnchor).not(n.exclude).click(function(){return _Click(this),!1})},_Click=function(e){var o=t(e).attr(n.ajaxURL).split("/");o=o[o.length-1].split(".")[0],_tryShowContent(o.toLowerCase()),history.pushState("","",o+n.pageExtension)},t(n.ajaxAnchor).not(n.exclude).on("click",function(){return _Click(this),!1}),window.onpopstate=function(){if(null!==window.history.state){var t=document.location.href.split("/");t=t[t.length-1].split(".")[0],_tryShowContent(t.toLowerCase())}},_getState=function(t){var n=a[a.indexOf(t)]["Pre.Load.State"];for(var e in o){var i=new RegExp(o[e]);if(n.match(i))return o[e]}},_tryShowContent=function(t){var n=_getState(t);switch(n){case o[0]:a[a.indexOf(t)]["Pre.Load.State"]="loading",_prelaodContent(t,"true");break;case o[1]:window.setTimeout(function(){_tryShowContent(t)},100);break;case o[2]:_showContent(t)}},_showContent=function(e){switch(t(n.ajaxContainer).css("display","none"),t("."+e).css("display","block"),e){case"index":case"project":case"jobs":}"kontakt"==e&&(t("#map").is(".olMap")||drawmap())}},Array.prototype.GetMultiArray=function(t){this[t]=new Array([])},Array.prototype.append=function(t){this[t]=new Array([])},Array.prototype.indexOf=function(t){for(var n=0;n<this.length;n++)if(t.toLowerCase()==this[n]["Link.Name"])return n},Array.prototype.contains=function(t){for(var n=this.length;n--;)if(this[n]&&this[n]["Link.Name"]===t.toLowerCase())return!0;return!1}}(jQuery);
